<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Pos Pro</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body{margin:0;font-family:TahomĞ°;background:#f4f6f8}
header{background:#0d6efd;color:#fff;padding:15px;text-align:center;font-size:20px}
nav{display:flex;background:#fff;border-bottom:1px solid #ddd}
nav button{flex:1;border:none;background:none;padding:12px;font-size:14px}
nav button.active{background:#0d6efd;color:#fff}
.box{background:#fff;margin:10px;padding:15px;border-radius:8px}
input,select,button{width:100%;padding:10px;margin-top:6px;font-size:15px}
button.primary{background:#0d6efd;color:#fff;border:none}
button.red{background:#dc3545;color:#fff;border:none}
.hidden{display:none}
hr{margin:15px 0}
@media print{
  nav,header,button{display:none}
  body{background:#fff}
}
</style>
</head>

<body>

<header>ğŸ“Š Pos Pro â€“ Ø¨Ø±Ù†Ø§Ù…Ø¬ Ù…Ø­Ø§Ø³Ø¨ÙŠ Ø³Ø­Ø§Ø¨ÙŠ</header>

<!-- AUTH -->
<div class="box" id="authBox">
<h3>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h3>
<input id="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
<input id="password" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
<button class="primary" onclick="login()">Ø¯Ø®ÙˆÙ„</button>
<button onclick="register()">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</button>
<p id="authMsg"></p>
</div>

<!-- APP -->
<div id="appBox" class="hidden">

<nav>
<button class="active" onclick="show('sales',this)">Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</button>
<button onclick="show('products',this)">Ø§Ù„Ø£ØµÙ†Ø§Ù</button>
<button onclick="show('expenses',this)">Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</button>
<button onclick="show('reports',this)">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</button>
<button onclick="show('settings',this)">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
</nav>

<div class="box">
Ù…Ø±Ø­Ø¨Ù‹Ø§ ğŸ‘‹ <b id="userName"></b>
<button class="red" onclick="logout()">Ø®Ø±ÙˆØ¬</button>
</div>

<!-- SALES -->
<div class="box" id="sales">
<h3>ğŸ§¾ ÙØ§ØªÙˆØ±Ø© Ø¨ÙŠØ¹</h3>
<select id="saleProduct"></select>
<input id="saleQty" type="number" value="1">
<button class="primary" onclick="addToInvoice()">â• Ø¥Ø¶Ø§ÙØ©</button>
<hr>
<div id="invoiceItems"></div>
<p>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <b id="subTotal">0</b></p>
<p id="taxRow" class="hidden">Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©: <b id="taxAmount">0</b></p>
<p>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ: <b id="grandTotal">0</b></p>
<button onclick="window.print()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</button>
<button class="primary" onclick="saveInvoice()">ğŸ’¾ Ø­ÙØ¸</button>
</div>

<!-- PRODUCTS -->
<div class="box hidden" id="products">
<h3>ğŸ“¦ Ø§Ù„Ø£ØµÙ†Ø§Ù</h3>
<input id="pName" placeholder="Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù">
<input id="pPrice" type="number" placeholder="Ø§Ù„Ø³Ø¹Ø±">
<input id="pQty" type="number" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©">
<button class="primary" onclick="addProduct()">Ø¥Ø¶Ø§ÙØ©</button>
<div id="productList"></div>
</div>

<!-- EXPENSES -->
<div class="box hidden" id="expenses">
<h3>ğŸ’¸ Ù…ØµØ±ÙˆÙØ§Øª</h3>
<select id="expenseType">
<option>Ø¥ÙŠØ¬Ø§Ø±</option><option>ÙƒÙ‡Ø±Ø¨Ø§Ø¡</option><option>Ø±ÙˆØ§ØªØ¨</option><option>Ø£Ø®Ø±Ù‰</option>
</select>
<input id="expenseAmount" type="number" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº">
<button class="primary" onclick="addExpense()">Ø­ÙØ¸</button>
<div id="expenseList"></div>
</div>

<!-- REPORTS -->
<div class="box hidden" id="reports">
<h3>ğŸ“Š Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</h3>
<button onclick="loadReport()">Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
<div id="reportBox"></div>
</div>

<!-- SETTINGS -->
<div class="box hidden" id="settings">
<h3>âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h3>
<select id="taxEnabled">
<option value="false">Ø¨Ø¯ÙˆÙ† Ø¶Ø±ÙŠØ¨Ø©</option>
<option value="true">ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©</option>
</select>
<input id="taxRate" type="number" placeholder="Ù†Ø³Ø¨Ø© Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© %">
<button class="primary" onclick="saveSettings()">Ø­ÙØ¸</button>
</div>

</div>

<script>
/* Firebase */
firebase.initializeApp({
 apiKey:"AIzaSyBZwWxWIIE0exAPoL9P8pbmp19gnBFxQq0",
 authDomain:"pos-pro-996f0.firebaseapp.com",
 projectId:"pos-pro-996f0"
});

const auth=firebase.auth();
const db=firebase.firestore();
let user,products=[],invoice=[],settings={};

auth.onAuthStateChanged(u=>{
 if(u){user=u;authBox.classList.add("hidden");appBox.classList.remove("hidden");userName.innerText=u.email;loadAll();}
});

function register(){auth.createUserWithEmailAndPassword(email.value,password.value).catch(e=>authMsg.innerText=e.message)}
function login(){auth.signInWithEmailAndPassword(email.value,password.value).catch(e=>authMsg.innerText=e.message)}
function logout(){auth.signOut();location.reload()}

/* NAV */
function show(id,b){
 document.querySelectorAll(".box").forEach(x=>x.classList.add("hidden"));
 document.getElementById(id).classList.remove("hidden");
 document.querySelectorAll("nav button").forEach(x=>x.classList.remove("active"));
 b.classList.add("active");
}

/* PRODUCTS */
function addProduct(){
 db.collection("products").add({uid:user.uid,name:pName.value,price:+pPrice.value,qty:+pQty.value});
 pName.value=pPrice.value=pQty.value="";
 loadProducts();
}

function loadProducts(){
 saleProduct.innerHTML="";productList.innerHTML="";
 db.collection("products").where("uid","==",user.uid).get().then(s=>{
  products=[];
  s.forEach(d=>{
   products.push({...d.data(),id:d.id});
   saleProduct.innerHTML+=`<option value="${d.id}">${d.data().name}</option>`;
   productList.innerHTML+=`<div>${d.data().name} | ${d.data().qty}</div>`;
  });
 });
}

/* SALES */
function addToInvoice(){
 let p=products.find(x=>x.id==saleProduct.value);
 invoice.push({...p,qty:+saleQty.value,total:p.price*saleQty.value});
 renderInvoice();
}

function renderInvoice(){
 let s=0;invoiceItems.innerHTML="";
 invoice.forEach(i=>{s+=i.total;invoiceItems.innerHTML+=`<div>${i.name} Ã— ${i.qty}</div>`});
 subTotal.innerText=s;
 let tax=settings.taxEnabled?s*(settings.taxRate/100):0;
 taxRow.classList.toggle("hidden",!settings.taxEnabled);
 taxAmount.innerText=tax;
 grandTotal.innerText=s+tax;
}

function saveInvoice(){
 db.collection("invoices").add({uid:user.uid,total:+grandTotal.innerText,date:new Date()});
 invoice=[];renderInvoice();
}

/* EXPENSES */
function addExpense(){
 db.collection("expenses").add({uid:user.uid,type:expenseType.value,amount:+expenseAmount.value,date:new Date()});
 expenseAmount.value="";
 loadExpenses();
}

function loadExpenses(){
 expenseList.innerHTML="";
 db.collection("expenses").where("uid","==",user.uid).get().then(s=>{
  s.forEach(d=>expenseList.innerHTML+=`<div>${d.data().type} - ${d.data().amount}</div>`);
 });
}

/* REPORT */
function loadReport(){
 let sales=0,exp=0;
 db.collection("invoices").where("uid","==",user.uid).get().then(s=>{
  s.forEach(d=>sales+=d.data().total);
  db.collection("expenses").where("uid","==",user.uid).get().then(e=>{
   e.forEach(d=>exp+=d.data().amount);
   reportBox.innerHTML=`Ù…Ø¨ÙŠØ¹Ø§Øª: ${sales}<br>Ù…ØµØ±ÙˆÙØ§Øª: ${exp}<br><b>ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­: ${sales-exp}</b>`;
  });
 });
}

/* SETTINGS */
function saveSettings(){
 settings={taxEnabled:taxEnabled.value==="true",taxRate:+taxRate.value};
 db.collection("settings").doc(user.uid).set(settings);
}

function loadSettings(){
 db.collection("settings").doc(user.uid).get().then(d=>{if(d.exists)settings=d.data()});
}

function loadAll(){loadProducts();loadExpenses();loadSettings()}
</script>

</body>
</html>
