<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Pos Pro SaaS</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
:root{
  --primary:#2563eb;
  --primary-dark:#1e40af;
  --bg:#f1f5f9;
  --card:#ffffff;
  --text:#0f172a;
  --muted:#64748b;
  --danger:#dc2626;
  --radius:10px;
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family:"Segoe UI",Tahoma,Arial;
  background:var(--bg);
  color:var(--text);
}

header{
  background:linear-gradient(135deg,var(--primary),var(--primary-dark));
  color:#fff;
  padding:18px;
  text-align:center;
  font-size:20px;
  font-weight:bold;
}

nav{
  display:flex;
  background:#fff;
  border-bottom:1px solid #e5e7eb;
}

nav button{
  flex:1;
  border:none;
  background:none;
  padding:14px 5px;
  font-size:14px;
  color:var(--muted);
  cursor:pointer;
}

nav button.active{
  color:var(--primary);
  border-bottom:3px solid var(--primary);
  font-weight:600;
}

.box{
  background:var(--card);
  margin:14px;
  padding:16px;
  border-radius:var(--radius);
  box-shadow:0 4px 12px rgba(0,0,0,.06);
}

h3{margin:0 0 10px}

input,select{
  width:100%;
  padding:12px;
  border-radius:8px;
  border:1px solid #e5e7eb;
  font-size:14px;
}

button{
  padding:12px;
  border-radius:8px;
  border:none;
  font-size:14px;
  cursor:pointer;
}

button.primary{
  background:var(--primary);
  color:#fff;
}

button.primary:hover{background:var(--primary-dark)}

button.red{
  background:var(--danger);
  color:#fff;
}

.list-item{
  padding:10px;
  border-bottom:1px solid #e5e7eb;
}

.list-item:last-child{border-bottom:none}

.badge{
  float:left;
  padding:4px 8px;
  border-radius:20px;
  font-size:12px;
  background:#e0e7ff;
  color:var(--primary);
}

.total{
  font-size:18px;
  font-weight:bold;
  margin-top:10px;
}

.hidden{display:none}

@media print{
  nav,header,button{display:none}
  body{background:#fff}
  .box{box-shadow:none}
}
</style>
</head>

<body>

<header>ğŸ“Š Pos Pro â€“ Ù†Ø¸Ø§Ù… Ù…Ø­Ø§Ø³Ø¨ÙŠ Ø³Ø­Ø§Ø¨ÙŠ</header>

<!-- AUTH -->
<div class="box" id="authBox">
<h3>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h3>
<input id="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
<input id="password" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
<button class="primary" onclick="login()">Ø¯Ø®ÙˆÙ„</button>
<button onclick="register()">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</button>
<p id="authMsg"></p>
</div>

<!-- APP -->
<div id="appBox" class="hidden">

<nav>
<button class="active" onclick="show('sales',this)">ÙÙˆØ§ØªÙŠØ±</button>
<button onclick="show('products',this)">Ø£ØµÙ†Ø§Ù</button>
<button onclick="show('expenses',this)">Ù…ØµØ±ÙˆÙØ§Øª</button>
<button onclick="show('reports',this)">ØªÙ‚Ø§Ø±ÙŠØ±</button>
<button onclick="show('settings',this)">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
</nav>

<div class="box">
Ù…Ø±Ø­Ø¨Ù‹Ø§ ğŸ‘‹ <b id="userName"></b>
<button class="red" onclick="logout()">Ø®Ø±ÙˆØ¬</button>
</div>

<!-- SALES -->
<div class="box" id="sales">
<h3>ğŸ§¾ ÙØ§ØªÙˆØ±Ø© Ø¨ÙŠØ¹</h3>
<select id="saleProduct"></select>
<input id="saleQty" type="number" value="1">
<button class="primary" onclick="addToInvoice()">â• Ø¥Ø¶Ø§ÙØ©</button>
<hr>
<div id="invoiceItems"></div>
<div class="total">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <span id="grandTotal">0</span></div>
<button onclick="window.print()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</button>
<button class="primary" onclick="saveInvoice()">ğŸ’¾ Ø­ÙØ¸</button>
</div>

<!-- PRODUCTS -->
<div class="box hidden" id="products">
<h3>ğŸ“¦ Ø§Ù„Ø£ØµÙ†Ø§Ù</h3>
<input id="pName" placeholder="Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù">
<input id="pPrice" type="number" placeholder="Ø§Ù„Ø³Ø¹Ø±">
<button class="primary" onclick="addProduct()">Ø¥Ø¶Ø§ÙØ©</button>
<div id="productList"></div>
</div>

<!-- EXPENSES -->
<div class="box hidden" id="expenses">
<h3>ğŸ’¸ Ù…ØµØ±ÙˆÙØ§Øª</h3>
<input id="expenseNote" placeholder="Ø§Ù„ÙˆØµÙ">
<input id="expenseAmount" type="number" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº">
<button class="primary" onclick="addExpense()">Ø­ÙØ¸</button>
<div id="expenseList"></div>
</div>

<!-- REPORTS -->
<div class="box hidden" id="reports">
<h3>ğŸ“Š Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</h3>
<input type="date" id="fromDate">
<input type="date" id="toDate">
<button class="primary" onclick="loadReport()">Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
<div id="reportBox"></div>
</div>

<!-- SETTINGS -->
<div class="box hidden" id="settings">
<h3>âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h3>
<input id="displayName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
<button class="primary" onclick="saveProfile()">Ø­ÙØ¸</button>
<p id="subStatus"></p>
</div>

</div>

<script>
/* Firebase */
firebase.initializeApp({
 apiKey:"AIzaSyBZwWxWIIE0exAPoL9P8pbmp19gnBFxQq0",
 authDomain:"pos-pro-996f0.firebaseapp.com",
 projectId:"pos-pro-996f0"
});

const auth=firebase.auth();
const db=firebase.firestore();
db.enablePersistence();

let user,products=[],invoice=[];

/* AUTH */
auth.onAuthStateChanged(async u=>{
 if(!u) return;
 user=u;
 authBox.classList.add("hidden");
 appBox.classList.remove("hidden");
 userName.innerText=u.displayName||u.email;
 await checkSubscription();
 loadAll();
});

/* SaaS Subscription */
async function checkSubscription(){
 const ref=db.collection("subscriptions").doc(user.uid);
 const d=await ref.get();
 if(!d.exists){
  await ref.set({start:new Date(),trial:14});
  subStatus.innerText="ğŸ†“ ØªØ¬Ø±Ø¨Ø© 14 ÙŠÙˆÙ…";
 }
}

/* LOGIN */
function register(){auth.createUserWithEmailAndPassword(email.value,password.value).catch(e=>authMsg.innerText=e.message)}
function login(){auth.signInWithEmailAndPassword(email.value,password.value).catch(e=>authMsg.innerText=e.message)}
function logout(){auth.signOut();location.reload()}

/* NAV */
function show(id,b){
 document.querySelectorAll(".box").forEach(x=>x.classList.add("hidden"));
 document.getElementById(id).classList.remove("hidden");
 document.querySelectorAll("nav button").forEach(x=>x.classList.remove("active"));
 b.classList.add("active");
}

/* PRODUCTS */
async function addProduct(){
 await db.collection("products").add({uid:user.uid,name:pName.value,price:+pPrice.value});
 pName.value=pPrice.value="";
 loadProducts();
}

async function loadProducts(){
 saleProduct.innerHTML="";
 productList.innerHTML="";
 const s=await db.collection("products").where("uid","==",user.uid).get();
 products=[];
 s.forEach(d=>{
  products.push({...d.data(),id:d.id});
  saleProduct.innerHTML+=`<option value="${d.id}">${d.data().name}</option>`;
  productList.innerHTML+=`
   <div class="list-item">
    ${d.data().name}
    <span class="badge">${d.data().price} Ø¬</span>
   </div>`;
 });
}

/* SALES */
function addToInvoice(){
 const p=products.find(x=>x.id===saleProduct.value);
 invoice.push({...p,qty:+saleQty.value,total:p.price*saleQty.value});
 renderInvoice();
}

function renderInvoice(){
 let s=0;
 invoiceItems.innerHTML="";
 invoice.forEach(i=>{
  s+=i.total;
  invoiceItems.innerHTML+=`
   <div class="list-item">
    <b>${i.name}</b><br>
    ${i.qty} Ã— ${i.price} = <b>${i.total}</b>
   </div>`;
 });
 grandTotal.innerText=s;
}

async function saveInvoice(){
 await db.collection("invoices").add({
  uid:user.uid,
  items:invoice,
  total:+grandTotal.innerText,
  date:new Date()
 });
 invoice=[];
 renderInvoice();
}

/* EXPENSE */
async function addExpense(){
 await db.collection("expenses").add({
  uid:user.uid,
  note:expenseNote.value,
  amount:+expenseAmount.value,
  date:new Date()
 });
 expenseNote.value=expenseAmount.value="";
 loadExpenses();
}

async function loadExpenses(){
 expenseList.innerHTML="";
 const s=await db.collection("expenses").where("uid","==",user.uid).get();
 s.forEach(d=>{
  expenseList.innerHTML+=`
   <div class="list-item">
    ${d.data().note}
    <span class="badge">${d.data().amount} Ø¬</span>
   </div>`;
 });
}

/* REPORT */
async function loadReport(){
 let sales=0,exp=0;
 const inv=await db.collection("invoices").where("uid","==",user.uid).get();
 inv.forEach(d=>{
  const dt=d.data().date.toDate();
  if((!fromDate.value||dt>=new Date(fromDate.value))&&(!toDate.value||dt<=new Date(toDate.value)))
    sales+=d.data().total;
 });
 const ex=await db.collection("expenses").where("uid","==",user.uid).get();
 ex.forEach(d=>exp+=d.data().amount);

 reportBox.innerHTML=`
 <div class="box">
  <div class="list-item">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª <b>${sales}</b></div>
  <div class="list-item">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª <b>${exp}</b></div>
  <div class="total">ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­: ${sales-exp}</div>
 </div>`;
}

/* PROFILE */
function saveProfile(){
 auth.currentUser.updateProfile({displayName:displayName.value});
 userName.innerText=displayName.value;
}

/* LOAD */
function loadAll(){
 loadProducts();
 loadExpenses();
}
</script>

<script>
if("serviceWorker" in navigator){
 navigator.serviceWorker.register("service-worker.js");
}
</script>

</body>
</html>
