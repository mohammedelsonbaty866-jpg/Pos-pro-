<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Pos Pro</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Firebase CDN (ØµØ­ÙŠØ­ Ù„Ù„ÙˆÙŠØ¨ Ø§Ù„Ù…Ø¨Ø§Ø´Ø±) -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body{font-family:Tahoma;background:#f4f6f8;margin:0}
header{background:#0d6efd;color:#fff;padding:15px;text-align:center;font-size:20px}
.box{background:#fff;margin:10px;padding:15px;border-radius:6px}
input,button{width:100%;padding:10px;margin-top:6px;font-size:15px}
button.primary{background:#0d6efd;color:#fff;border:none}
button.red{background:#dc3545;color:#fff;border:none}
.hidden{display:none}
hr{margin:15px 0}
</style>
</head>

<body>

<header>ğŸ“Š Pos Pro â€“ Ø¨Ø±Ù†Ø§Ù…Ø¬ Ù…Ø­Ø§Ø³Ø¨ÙŠ Ø³Ø­Ø§Ø¨ÙŠ</header>

<!-- ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
<div class="box" id="authBox">
<h3>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h3>
<input id="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
<input id="password" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
<button class="primary" onclick="login()">Ø¯Ø®ÙˆÙ„</button>
<button onclick="register()">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</button>
<p id="authMsg"></p>
</div>

<!-- Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ -->
<div class="hidden" id="appBox">

<div class="box">
<h3>Ù…Ø±Ø­Ø¨Ù‹Ø§ ğŸ‘‹ <span id="userName"></span></h3>
<button class="red" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
</div>

<div class="box">
<h4>ğŸ§¾ ÙØ§ØªÙˆØ±Ø© Ø¨ÙŠØ¹</h4>
<input id="invoiceTotal" type="number" placeholder="Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙØ§ØªÙˆØ±Ø©">
<button class="primary" onclick="saveInvoice()">Ø­ÙØ¸ Ø§Ù„ÙØ§ØªÙˆØ±Ø©</button>
</div>

<div class="box">
<h4>ğŸ’¸ Ù…ØµØ±ÙˆÙ</h4>
<input id="expenseAmount" type="number" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº">
<input id="expenseNote" placeholder="Ø§Ù„ÙˆØµÙ">
<button class="primary" onclick="saveExpense()">Ø­ÙØ¸ Ø§Ù„Ù…ØµØ±ÙˆÙ</button>
</div>

<div class="box">
<h4>ğŸ“„ Ø§Ù„ÙÙˆØ§ØªÙŠØ±</h4>
<div id="invoiceList"></div>
</div>

<div class="box">
<h4>ğŸ“Š Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</h4>
<button onclick="generateReport()">Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
<div id="reportBox"></div>
</div>

<p id="status"></p>
</div>

<script>
/* ğŸ”¥ Firebase Config (Ù…Ø¯Ù…Ø¬ Ù…Ù† Ø¨ÙŠØ§Ù†Ø§ØªÙƒ) */
const firebaseConfig = {
  apiKey: "AIzaSyBZwWxWIIE0exAPoL9P8pbmp19gnBFxQq0",
  authDomain: "pos-pro-996f0.firebaseapp.com",
  projectId: "pos-pro-996f0",
  storageBucket: "pos-pro-996f0.firebasestorage.app",
  messagingSenderId: "591451935128",
  appId: "1:591451935128:web:683495139e62fb9b1e1bed"
};

firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.firestore();
let currentUser = null;

/* AUTH */
auth.onAuthStateChanged(user=>{
  if(user){
    currentUser=user;
    authBox.classList.add("hidden");
    appBox.classList.remove("hidden");
    userName.innerText=user.email;
    loadInvoices();
  }
});

function register(){
  auth.createUserWithEmailAndPassword(email.value,password.value)
  .catch(e=>authMsg.innerText=e.message);
}

function login(){
  auth.signInWithEmailAndPassword(email.value,password.value)
  .catch(e=>authMsg.innerText=e.message);
}

function logout(){
  auth.signOut();
  location.reload();
}

/* INVOICE */
function saveInvoice(){
  const total=+invoiceTotal.value;
  if(!total) return;

  db.collection("invoices").add({
    uid:currentUser.uid,
    number:"INV-"+Date.now(),
    total:total,
    date:new Date()
  }).then(()=>{
    invoiceTotal.value="";
    loadInvoices();
    status.innerText="âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„ÙØ§ØªÙˆØ±Ø©";
  });
}

/* EXPENSE */
function saveExpense(){
  const amount=+expenseAmount.value;
  if(!amount) return;

  db.collection("expenses").add({
    uid:currentUser.uid,
    amount:amount,
    note:expenseNote.value,
    date:new Date()
  }).then(()=>{
    expenseAmount.value="";
    expenseNote.value="";
    status.innerText="âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…ØµØ±ÙˆÙ";
  });
}

/* LOAD INVOICES */
function loadInvoices(){
  invoiceList.innerHTML="";
  db.collection("invoices")
  .where("uid","==",currentUser.uid)
  .orderBy("date","desc")
  .get()
  .then(snap=>{
    snap.forEach(doc=>{
      const i=doc.data();
      invoiceList.innerHTML+=`
      <div class="box">
      ${i.number}<br>
      ${i.date.toDate().toLocaleString("ar-EG")}<br>
      Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${i.total} Ø¬
      <button onclick="printInvoice('${i.number}',${i.total})">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</button>
      </div>`;
    });
  });
}

/* REPORT */
function generateReport(){
  let sales=0,expenses=0;

  db.collection("invoices").where("uid","==",currentUser.uid).get()
  .then(s=>{
    s.forEach(d=>sales+=d.data().total);

    db.collection("expenses").where("uid","==",currentUser.uid).get()
    .then(e=>{
      e.forEach(d=>expenses+=d.data().amount);

      reportBox.innerHTML=`
      <div class="box">
      Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª: ${sales} Ø¬<br>
      Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª: ${expenses} Ø¬<br>
      <b>ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­: ${sales-expenses} Ø¬</b>
      </div>`;
    });
  });
}

/* PRINT */
function printInvoice(num,total){
  const w=window.open("");
  w.document.write(`<h2>Pos Pro</h2><p>${num}</p><p>${total} Ø¬Ù†ÙŠÙ‡</p>`);
  w.print();
}
</script>

</body>
</html>
